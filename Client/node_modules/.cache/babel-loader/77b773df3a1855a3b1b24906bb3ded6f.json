{"ast":null,"code":"import _toConsumableArray from\"D:/Project Web/Project Web/PROJECT 12 (Only MERN)/Client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"D:/Project Web/Project Web/PROJECT 12 (Only MERN)/Client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _objectSpread from\"D:/Project Web/Project Web/PROJECT 12 (Only MERN)/Client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _asyncToGenerator from\"D:/Project Web/Project Web/PROJECT 12 (Only MERN)/Client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import{deleteAPI,getAPI,patchAPI,postAPI}from'../../apis/Axios';import{upload}from'../../apis/Cloudinary';import{createNotice,deletePostNotices}from'./noticeAction';export var createPost=function createPost(data,auth,socket){return/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(dispatch){var media,res,newPost,msg;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:media=[];_context.prev=1;dispatch({type:'ALERT',payload:{loading:true}});dispatch({type:'MODAL',payload:true});if(!(data.files.length>0)){_context.next=8;break;}_context.next=7;return upload(data.files);case 7:media=_context.sent;case 8:_context.next=10;return postAPI('post',{body:data.text,media:media},auth.token);case 10:res=_context.sent;newPost=_objectSpread(_objectSpread({},res.data.newPost),{},{user:auth.user});dispatch({type:'CREATE_POST',payload:newPost});dispatch({type:'ALERT',payload:{success:res.data.msg}});msg={id:res.data.newPost._id,receivers:newPost.user.followers,url:res.data.newPost._id,type:'post',body:data.body};msg=_objectSpread(_objectSpread({},msg),{},{text:\"\".concat(media.length>0?media[0].url.match(/video/i)?'add new video':'add new image':'post a status'),tag:\"\".concat(media.length>0?media[0].url.match(/video/i)?'VIDEO':'IMAGE':'POST')});dispatch(createNotice(auth,msg,socket));_context.next=23;break;case 19:_context.prev=19;_context.t0=_context[\"catch\"](1);dispatch({type:'MODAL',payload:false});dispatch({type:'ALERT',payload:{error:_context.t0.response.data.msg}});case 23:case\"end\":return _context.stop();}}},_callee,null,[[1,19]]);}));return function(_x){return _ref.apply(this,arguments);};}();};export var getPosts=function getPosts(auth){return/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(dispatch){var res;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;dispatch({type:'LOADING_POST',payload:true});_context2.next=4;return getAPI('post',auth.token);case 4:res=_context2.sent;if(res.data.result.length>0)dispatch({type:'GET_POSTS',payload:res.data.result});dispatch({type:'LOADING_POST',payload:false});_context2.next=12;break;case 9:_context2.prev=9;_context2.t0=_context2[\"catch\"](0);dispatch({type:'ALERT',payload:{error:_context2.t0.response.data.msg}});case 12:case\"end\":return _context2.stop();}}},_callee2,null,[[0,9]]);}));return function(_x2){return _ref2.apply(this,arguments);};}();};export var getPost=function getPost(auth,id){return/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(dispatch){var res;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;dispatch({type:'LOADING_POST',payload:true});_context3.next=4;return getAPI(\"post/\".concat(id),auth.token);case 4:res=_context3.sent;dispatch({type:'GET_POST',payload:res.data.post});dispatch({type:'LOADING_POST',payload:false});_context3.next=13;break;case 9:_context3.prev=9;_context3.t0=_context3[\"catch\"](0);dispatch({type:'GET_POST',payload:_context3.t0.response.data.post});dispatch({type:'ALERT',payload:{error:_context3.t0.response.data.msg}});case 13:case\"end\":return _context3.stop();}}},_callee3,null,[[0,9]]);}));return function(_x3){return _ref3.apply(this,arguments);};}();};export var updatePost=function updatePost(content,auth,id){return/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(dispatch){var res;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.prev=0;dispatch({type:'ALERT',payload:{loading:true}});dispatch({type:'MODAL',payload:true});_context4.next=5;return patchAPI(\"post/\".concat(id),{body:content},auth.token);case 5:res=_context4.sent;// logic\ndispatch({type:'UPDATE_POST',payload:res.data.newPost});dispatch({type:'GET_POST',payload:res.data.newPost});dispatch({type:'MODAL',payload:false});dispatch({type:'ALERT',payload:{success:res.data.msg}});_context4.next=16;break;case 12:_context4.prev=12;_context4.t0=_context4[\"catch\"](0);dispatch({type:'MODAL',payload:false});dispatch({type:'ALERT',payload:{error:_context4.t0.response.data.msg}});case 16:case\"end\":return _context4.stop();}}},_callee4,null,[[0,12]]);}));return function(_x4){return _ref4.apply(this,arguments);};}();};export var deletePost=function deletePost(auth,id){return/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(dispatch){var res;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.prev=0;_context5.next=3;return deleteAPI(\"post/\".concat(id),auth.token);case 3:res=_context5.sent;dispatch({type:'DELETE_POST',payload:res.data.post});dispatch({type:'ALERT',payload:{success:res.data.msg}});dispatch(deletePostNotices(auth,id));_context5.next=12;break;case 9:_context5.prev=9;_context5.t0=_context5[\"catch\"](0);dispatch({type:'ALERT',payload:{error:_context5.t0.response.data.msg}});case 12:case\"end\":return _context5.stop();}}},_callee5,null,[[0,9]]);}));return function(_x5){return _ref5.apply(this,arguments);};}();};export var likePost=function likePost(auth,post,socket){return/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(dispatch){var newPost,msg;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:if(!(auth.user._id===post.user._id)){_context6.next=2;break;}return _context6.abrupt(\"return\",dispatch({type:'ALERT',payload:{warn:'Dont like your own post! '}}));case 2:newPost=_objectSpread(_objectSpread({},post),{},{likes:[].concat(_toConsumableArray(post.likes),[auth.user])});dispatch({type:'UPDATE_POST',payload:newPost});socket.emit('likePost',newPost);_context6.prev=5;_context6.next=8;return patchAPI(\"post/\".concat(post._id,\"/like\"),newPost,auth.token);case 8:msg={id:auth.user._id,receivers:auth.user.followers,text:'like your post!',type:'post',url:newPost._id,tag:'LIKE',body:''};dispatch(createNotice(auth,msg,socket));_context6.next=15;break;case 12:_context6.prev=12;_context6.t0=_context6[\"catch\"](5);dispatch({type:'ALERT',payload:{error:_context6.t0.response.data.msg}});case 15:case\"end\":return _context6.stop();}}},_callee6,null,[[5,12]]);}));return function(_x6){return _ref6.apply(this,arguments);};}();};export var unlikePost=function unlikePost(auth,post,socket){return/*#__PURE__*/function(){var _ref7=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(dispatch){var newLikes,newPost;return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:newLikes=post.likes.filter(function(like){return like._id!==auth.user._id;});newPost=_objectSpread(_objectSpread({},post),{},{likes:newLikes});dispatch({type:'UPDATE_POST',payload:newPost});socket.emit('unlikePost',newPost);_context7.prev=4;_context7.next=7;return patchAPI(\"post/\".concat(post._id,\"/unlike\"),null,auth.token);case 7:_context7.next=12;break;case 9:_context7.prev=9;_context7.t0=_context7[\"catch\"](4);dispatch({type:'ALERT',payload:{error:_context7.t0.response.data.msg}});case 12:case\"end\":return _context7.stop();}}},_callee7,null,[[4,9]]);}));return function(_x7){return _ref7.apply(this,arguments);};}();};export var sharePost=function sharePost(auth,post,body,socket){return/*#__PURE__*/function(){var _ref8=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee8(dispatch){var res,newPost,msg;return _regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:_context8.prev=0;_context8.next=3;return postAPI(\"post/\".concat(post._id,\"/share\"),{post:post,body:body},auth.token);case 3:res=_context8.sent;newPost=_objectSpread(_objectSpread({},res.data.newPost),{},{user:auth.user});console.log(newPost);dispatch({type:'CREATE_POST',payload:newPost});console.log('wtf');msg={id:newPost._id,receivers:newPost.user.followers,url:newPost._id,body:body,type:'post',text:'share a post',tag:'POST'};dispatch({type:'ALERT',payload:{success:res.data.msg}});dispatch(createNotice(auth,msg,socket));_context8.next=16;break;case 13:_context8.prev=13;_context8.t0=_context8[\"catch\"](0);dispatch({type:'ALERT',payload:{error:_context8.t0.response.data.msg}});case 16:case\"end\":return _context8.stop();}}},_callee8,null,[[0,13]]);}));return function(_x8){return _ref8.apply(this,arguments);};}();};export var savePost=function savePost(auth,id){return/*#__PURE__*/function(){var _ref9=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee9(dispatch){var res;return _regeneratorRuntime.wrap(function _callee9$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:_context9.prev=0;_context9.next=3;return patchAPI(\"post/\".concat(id,\"/save\"),null,auth.token);case 3:res=_context9.sent;dispatch({type:'AUTH',payload:_objectSpread(_objectSpread({},auth),{},{user:res.data.newUser})});dispatch({type:'ALERT',payload:{success:res.data.msg}});_context9.next=11;break;case 8:_context9.prev=8;_context9.t0=_context9[\"catch\"](0);dispatch({type:'ALERT',payload:{error:_context9.t0.response.data.msg}});case 11:case\"end\":return _context9.stop();}}},_callee9,null,[[0,8]]);}));return function(_x9){return _ref9.apply(this,arguments);};}();};export var unsavePost=function unsavePost(auth,id){return/*#__PURE__*/function(){var _ref10=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee10(dispatch){var res;return _regeneratorRuntime.wrap(function _callee10$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:_context10.prev=0;_context10.next=3;return patchAPI(\"post/\".concat(id,\"/unsave\"),null,auth.token);case 3:res=_context10.sent;dispatch({type:'AUTH',payload:_objectSpread(_objectSpread({},auth),{},{user:res.data.newUser})});dispatch({type:'ALERT',payload:{success:res.data.msg}});_context10.next=11;break;case 8:_context10.prev=8;_context10.t0=_context10[\"catch\"](0);dispatch({type:'ALERT',payload:{error:_context10.t0.response.data.msg}});case 11:case\"end\":return _context10.stop();}}},_callee10,null,[[0,8]]);}));return function(_x10){return _ref10.apply(this,arguments);};}();};","map":{"version":3,"sources":["D:/Project Web/Project Web/PROJECT 12 (Only MERN)/Client/src/store/actions/postAction.js"],"names":["deleteAPI","getAPI","patchAPI","postAPI","upload","createNotice","deletePostNotices","createPost","data","auth","socket","dispatch","media","type","payload","loading","files","length","body","text","token","res","newPost","user","success","msg","id","_id","receivers","followers","url","match","tag","error","response","getPosts","result","getPost","post","updatePost","content","deletePost","likePost","warn","likes","emit","unlikePost","newLikes","filter","like","sharePost","console","log","savePost","newUser","unsavePost"],"mappings":"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","sourcesContent":["import {deleteAPI, getAPI, patchAPI, postAPI} from '../../apis/Axios'\r\nimport {upload} from '../../apis/Cloudinary'\r\nimport {createNotice, deletePostNotices} from './noticeAction'\r\n\r\nexport const createPost = (data, auth, socket) => async (dispatch) => {\r\n    let media = []\r\n    try {\r\n        dispatch({type: 'ALERT', payload: {loading: true}})\r\n        dispatch({type: 'MODAL' , payload: true})\r\n        if(data.files.length > 0) media = await upload(data.files)\r\n\r\n        const res = await postAPI('post', {body: data.text, media: media}, auth.token)\r\n        const newPost = {...res.data.newPost, user: auth.user}\r\n\r\n        dispatch({type:'CREATE_POST', payload: newPost})\r\n        dispatch({type: 'ALERT', payload: {success: res.data.msg}})\r\n\r\n        let msg = {\r\n            id: res.data.newPost._id,\r\n            receivers: newPost.user.followers,\r\n            url: res.data.newPost._id,\r\n            type: 'post',\r\n            body: data.body\r\n        }\r\n        msg = {...msg, \r\n            text: `${media.length > 0 ? (media[0].url.match(/video/i) ? 'add new video' : 'add new image') : 'post a status'}`,\r\n            tag: `${media.length > 0 ? (media[0].url.match(/video/i) ? 'VIDEO' : 'IMAGE') : 'POST'}`,\r\n        }\r\n\r\n        dispatch(createNotice(auth, msg, socket))\r\n\r\n    } catch(err) {\r\n        dispatch({type: 'MODAL' , payload: false})\r\n        dispatch({type: 'ALERT', payload: {error: err.response.data.msg}})\r\n    }\r\n}\r\n\r\nexport const getPosts = (auth) => async (dispatch) => {\r\n    try {\r\n        dispatch({type: 'LOADING_POST', payload: true})\r\n        const res = await getAPI('post', auth.token)\r\n\r\n        if(res.data.result.length>0) dispatch({type: 'GET_POSTS', payload: res.data.result})       \r\n        dispatch({type: 'LOADING_POST', payload: false})\r\n\r\n    } catch(err) {\r\n        dispatch({type: 'ALERT', payload: {error: err.response.data.msg}})\r\n    }\r\n}\r\n\r\nexport const getPost = (auth, id) => async (dispatch) => {\r\n    try {\r\n        dispatch({type: 'LOADING_POST', payload: true})\r\n        const res = await getAPI(`post/${id}`, auth.token)\r\n        dispatch({type: 'GET_POST', payload: res.data.post})\r\n        dispatch({type: 'LOADING_POST', payload: false})\r\n\r\n    } catch(err) {\r\n        dispatch({type: 'GET_POST', payload: err.response.data.post})\r\n        dispatch({type: 'ALERT', payload: {error: err.response.data.msg}})\r\n    }\r\n}\r\n\r\nexport const updatePost = (content, auth, id) => async (dispatch) => {\r\n    try {\r\n        dispatch({ type: 'ALERT', payload: {loading: true} })\r\n        dispatch({type: 'MODAL' , payload: true})\r\n\r\n        const res = await patchAPI(`post/${id}`, {body: content}, auth.token)\r\n\r\n        // logic\r\n        dispatch({type: 'UPDATE_POST', payload: res.data.newPost})\r\n        dispatch({type: 'GET_POST', payload: res.data.newPost})\r\n        \r\n        dispatch({ type: 'MODAL' , payload: false})\r\n        dispatch({ type: 'ALERT', payload: {success: res.data.msg} })\r\n\r\n    } catch(err) {\r\n        dispatch({ type: 'MODAL' , payload: false})\r\n        dispatch({type: 'ALERT', payload: {error: err.response.data.msg}})\r\n    }\r\n}\r\n\r\nexport const deletePost = (auth, id) => async (dispatch) => {\r\n    try {\r\n        const res = await deleteAPI(`post/${id}`, auth.token)\r\n        dispatch({type: 'DELETE_POST', payload: res.data.post})\r\n        dispatch({ type: 'ALERT', payload: {success: res.data.msg}})\r\n\r\n        dispatch(deletePostNotices(auth, id))\r\n\r\n    } catch(err) {\r\n        dispatch({type: 'ALERT', payload: {error: err.response.data.msg}})\r\n    }\r\n}\r\n\r\nexport const likePost = (auth, post, socket) => async (dispatch) => {\r\n    if(auth.user._id === post.user._id) return dispatch({type: 'ALERT', payload: {warn: 'Dont like your own post! '}})\r\n    const newPost = {...post, likes: [...post.likes, auth.user]}\r\n    dispatch({type: 'UPDATE_POST', payload: newPost})\r\n    socket.emit('likePost', newPost)\r\n\r\n    try {\r\n        await patchAPI(`post/${post._id}/like`, newPost, auth.token)\r\n\r\n        const msg = {\r\n            id: auth.user._id,\r\n            receivers: auth.user.followers,\r\n            text: 'like your post!',\r\n            type: 'post',\r\n            url: newPost._id,\r\n            tag: 'LIKE',\r\n            body: ''\r\n        }\r\n\r\n        dispatch(createNotice(auth, msg, socket))\r\n\r\n    } catch(err) {\r\n        dispatch({type: 'ALERT', payload: {error: err.response.data.msg}})\r\n    }\r\n}\r\n\r\nexport const unlikePost = (auth, post, socket) => async (dispatch) => {\r\n    const newLikes = post.likes.filter(like => like._id !== auth.user._id)\r\n        const newPost = {...post, likes: newLikes}\r\n\r\n        dispatch({type: 'UPDATE_POST', payload: newPost})\r\n        socket.emit('unlikePost', newPost)\r\n\r\n    try {\r\n        await patchAPI(`post/${post._id}/unlike`, null, auth.token)     \r\n\r\n    } catch(err) {\r\n        dispatch({type: 'ALERT', payload: {error: err.response.data.msg}})\r\n    }\r\n}\r\n\r\nexport const sharePost = (auth, post, body, socket) => async (dispatch) => {\r\n    try {\r\n        const res = await postAPI(`post/${post._id}/share`, {post, body}, auth.token)\r\n        const newPost = {...res.data.newPost, user: auth.user}\r\n\r\n        console.log(newPost)\r\n\r\n        dispatch({type:'CREATE_POST', payload: newPost})\r\n\r\n        console.log('wtf')\r\n\r\n        let msg = {\r\n            id: newPost._id,\r\n            receivers: newPost.user.followers,\r\n            url: newPost._id,\r\n            body: body,\r\n            type: 'post',\r\n            text: 'share a post',\r\n            tag: 'POST'\r\n        }\r\n\r\n        dispatch({ type: 'ALERT', payload: {success: res.data.msg} })\r\n\r\n        dispatch(createNotice(auth, msg, socket))\r\n\r\n    } catch(err) {\r\n        dispatch({type: 'ALERT', payload: {error: err.response.data.msg}})\r\n    }\r\n}\r\n\r\nexport const savePost = (auth, id) => async (dispatch) => {\r\n    try {\r\n        const res = await patchAPI(`post/${id}/save`, null, auth.token)\r\n\r\n        dispatch({\r\n            type: 'AUTH',\r\n            payload: {\r\n                ...auth,\r\n                user: res.data.newUser\r\n            }\r\n        })\r\n\r\n        dispatch({ type: 'ALERT', payload: {success: res.data.msg}})\r\n\r\n    } catch(err) {\r\n        dispatch({type: 'ALERT', payload: {error: err.response.data.msg}})\r\n    }\r\n}\r\n\r\nexport const unsavePost = (auth, id) => async (dispatch) => {\r\n    try {\r\n        const res = await patchAPI(`post/${id}/unsave`, null, auth.token)\r\n\r\n        dispatch({\r\n            type: 'AUTH',\r\n            payload: {\r\n                ...auth,\r\n                user: res.data.newUser\r\n            }\r\n        })\r\n        \r\n        dispatch({ type: 'ALERT', payload: {success: res.data.msg} })\r\n\r\n    } catch(err) {\r\n        dispatch({type: 'ALERT', payload: {error: err.response.data.msg}})\r\n    }\r\n}"]},"metadata":{},"sourceType":"module"}