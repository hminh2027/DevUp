{"ast":null,"code":"import _toConsumableArray from\"D:/Project Web/Project Web/PROJECT 12 (Only MERN)/Client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"D:/Project Web/Project Web/PROJECT 12 (Only MERN)/Client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"D:/Project Web/Project Web/PROJECT 12 (Only MERN)/Client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/Project Web/Project Web/PROJECT 12 (Only MERN)/Client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import{getAPI,patchAPI}from'../../apis/Axios';import{upload}from'../../apis/Cloudinary';import{createNotice}from'./noticeAction';export var getUser=function getUser(auth,id){return/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(dispatch){var res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;dispatch({type:'LOADING_PROFILE',payload:true});_context.t0=Promise;_context.t1=getAPI(\"/user/\".concat(id),auth.token);_context.next=6;return getAPI(\"/post/user_posts/\".concat(id),auth.token);case 6:_context.t2=_context.sent;_context.t3=[_context.t1,_context.t2];_context.next=10;return _context.t0.all.call(_context.t0,_context.t3);case 10:res=_context.sent;dispatch({type:'GET_USER',payload:res[0].data.user});dispatch({type:'GET_POSTS',payload:res[1].data.result});dispatch({type:'LOADING_PROFILE',payload:false});_context.next=19;break;case 16:_context.prev=16;_context.t4=_context[\"catch\"](0);dispatch({type:'ALERT',payload:{error:_context.t4.response.data.msg}});case 19:case\"end\":return _context.stop();}}},_callee,null,[[0,16]]);}));return function(_x){return _ref.apply(this,arguments);};}();};export var follow=function follow(auth,user,socket){return/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(dispatch){var profileUser,res,msg;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:profileUser=_objectSpread(_objectSpread({},user),{},{followers:[].concat(_toConsumableArray(user.followers),[auth.user])});if(auth.user._id===user._id)dispatch({type:'FOLLOW',payload:profileUser});dispatch({type:'AUTH',payload:_objectSpread(_objectSpread({},auth),{},{user:_objectSpread(_objectSpread({},auth.user),{},{following:[].concat(_toConsumableArray(auth.user.following),[profileUser])})})});_context2.prev=3;_context2.next=6;return patchAPI(\"user/\".concat(user._id,\"/follow\"),null,auth.token);case 6:res=_context2.sent;socket.emit('follow',res.data.newUser);msg={id:auth.user._id,receivers:[user],text:'is following you!',type:'profile',url:auth.user._id,tag:'FOLLOW',body:''};dispatch(createNotice(auth,msg,socket));_context2.next=15;break;case 12:_context2.prev=12;_context2.t0=_context2[\"catch\"](3);dispatch({type:'ALERT',payload:{error:_context2.t0.response.data.msg}});case 15:case\"end\":return _context2.stop();}}},_callee2,null,[[3,12]]);}));return function(_x2){return _ref2.apply(this,arguments);};}();};export var unfollow=function unfollow(auth,user,socket){return/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(dispatch){var newFollowers,profileUser,newFollowing,res;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:newFollowers=user.followers.map(function(fl){return fl._id!==auth.user._id&&fl;});profileUser=_objectSpread(_objectSpread({},user),{},{followers:newFollowers});newFollowing=auth.user.following.map(function(fl){return fl._id!==profileUser._id&&fl;});if(auth.user._id===user._id)dispatch({type:'UNFOLLOW',payload:profileUser});dispatch({type:'AUTH',payload:_objectSpread(_objectSpread({},auth),{},{user:_objectSpread(_objectSpread({},auth.user),{},{following:newFollowing})})});_context3.prev=5;_context3.next=8;return patchAPI(\"user/\".concat(user._id,\"/unfollow\"),null,auth.token);case 8:res=_context3.sent;socket.emit('unfollow',res.data.newUser);_context3.next=15;break;case 12:_context3.prev=12;_context3.t0=_context3[\"catch\"](5);dispatch({type:'ALERT',payload:{error:_context3.t0.response.data.msg}});case 15:case\"end\":return _context3.stop();}}},_callee3,null,[[5,12]]);}));return function(_x3){return _ref3.apply(this,arguments);};}();};export var updateUser=function updateUser(auth,data,image){return/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(dispatch){var avatar,background,res;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.prev=0;dispatch({type:'ALERT',payload:{loading:true}});if(!image.avatar){_context4.next=6;break;}_context4.next=5;return upload([image.avatar]);case 5:avatar=_context4.sent;case 6:if(!image.background){_context4.next=10;break;}_context4.next=9;return upload([image.background]);case 9:background=_context4.sent;case 10:_context4.next=12;return patchAPI(\"user\",_objectSpread(_objectSpread({},data),{},{avatar:avatar?avatar[0].url:auth.user.avatar,background:background?background[0].url:auth.user.background}),auth.token);case 12:res=_context4.sent;dispatch({type:'AUTH',payload:_objectSpread(_objectSpread({},auth),{},{user:_objectSpread(_objectSpread(_objectSpread({},auth.user),data),{},{avatar:avatar?avatar[0].url:auth.user.avatar,background:background?background[0].url:auth.user.background})})});dispatch({type:'UPDATE_PROFILE',payload:res.data.newUser});dispatch({type:'ALERT',payload:{success:res.data.msg}});_context4.next=21;break;case 18:_context4.prev=18;_context4.t0=_context4[\"catch\"](0);dispatch({type:'ALERT',payload:{error:_context4.t0.response.data.msg}});case 21:case\"end\":return _context4.stop();}}},_callee4,null,[[0,18]]);}));return function(_x4){return _ref4.apply(this,arguments);};}();};","map":{"version":3,"sources":["D:/Project Web/Project Web/PROJECT 12 (Only MERN)/Client/src/store/actions/profileAction.js"],"names":["getAPI","patchAPI","upload","createNotice","getUser","auth","id","dispatch","type","payload","Promise","token","all","res","data","user","result","error","response","msg","follow","socket","profileUser","followers","_id","following","emit","newUser","receivers","text","url","tag","body","unfollow","newFollowers","map","fl","newFollowing","updateUser","image","loading","avatar","background","success"],"mappings":"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","sourcesContent":["import { getAPI, patchAPI } from '../../apis/Axios'\r\nimport { upload } from '../../apis/Cloudinary'\r\nimport { createNotice } from './noticeAction'\r\n\r\nexport const getUser = (auth, id) => async (dispatch)=> {\r\n    try {\r\n        dispatch({type: 'LOADING_PROFILE', payload: true})\r\n\r\n        const res = await Promise.all([getAPI(`/user/${id}`, auth.token), await getAPI(`/post/user_posts/${id}`, auth.token)])\r\n\r\n        dispatch({type:'GET_USER', payload: res[0].data.user})\r\n        dispatch({type:'GET_POSTS', payload: res[1].data.result})\r\n\r\n        dispatch({type: 'LOADING_PROFILE', payload: false})\r\n\r\n    } catch(err) {\r\n        dispatch({type: 'ALERT', payload: {error: err.response.data.msg}})\r\n    }\r\n}\r\n\r\n\r\nexport const follow = (auth, user, socket) => async (dispatch) => {\r\n    let profileUser = {...user, followers: [...user.followers, auth.user]}\r\n\r\n    if(auth.user._id === user._id) dispatch({type: 'FOLLOW' , payload: profileUser})\r\n    dispatch({type: 'AUTH', payload: {...auth, user: {...auth.user, following: [...auth.user.following, profileUser]}}})\r\n\r\n    try {\r\n        const res = await patchAPI(`user/${user._id}/follow`, null, auth.token)\r\n        socket.emit('follow', res.data.newUser)\r\n\r\n        const msg = {\r\n            id: auth.user._id,\r\n            receivers: [user],\r\n            text: 'is following you!',\r\n            type: 'profile',\r\n            url: auth.user._id,\r\n            tag: 'FOLLOW',\r\n            body: ''        \r\n        }\r\n\r\n        dispatch(createNotice(auth, msg, socket))\r\n    \r\n    } catch(err) {\r\n        dispatch({type: 'ALERT', payload: {error: err.response.data.msg}})\r\n    }\r\n}\r\n\r\nexport const unfollow = (auth, user, socket) => async (dispatch) => {\r\n    let  newFollowers = user.followers.map(fl=>fl._id!==auth.user._id && fl)\r\n    let profileUser = {...user, followers: newFollowers}\r\n    let newFollowing = auth.user.following.map(fl=>fl._id!==profileUser._id && fl)\r\n\r\n    if(auth.user._id === user._id) dispatch({type: 'UNFOLLOW' , payload: profileUser})\r\n    dispatch({type: 'AUTH', payload: {...auth, user: {...auth.user, following: newFollowing}}})\r\n\r\n    try {\r\n        const res = await patchAPI(`user/${user._id}/unfollow`, null, auth.token)\r\n        socket.emit('unfollow', res.data.newUser)\r\n        \r\n    } catch(err) {\r\n        dispatch({type: 'ALERT', payload: {error: err.response.data.msg}})\r\n    }\r\n}\r\n\r\nexport const updateUser = (auth, data, image) => async (dispatch) => {\r\n    try {\r\n        dispatch({ type: 'ALERT', payload: {loading: true} })\r\n        let avatar,background\r\n        if(image.avatar) avatar = await upload([image.avatar])\r\n        if(image.background) background = await upload([image.background])       \r\n\r\n        const res = await patchAPI(`user`, {\r\n            ...data,\r\n            avatar: avatar ? avatar[0].url : auth.user.avatar,\r\n            background: background ? background[0].url : auth.user.background\r\n        }, auth.token)\r\n\r\n        dispatch({\r\n            type: 'AUTH',\r\n            payload: {\r\n                ...auth,\r\n                user: {\r\n                    ...auth.user, ...data,\r\n                    avatar: avatar ? avatar[0].url : auth.user.avatar,\r\n                    background: background ? background[0].url : auth.user.background,\r\n                }\r\n            }\r\n        })\r\n\r\n        dispatch({\r\n            type: 'UPDATE_PROFILE', payload: res.data.newUser\r\n        })\r\n\r\n        dispatch({ type: 'ALERT', payload: {success: res.data.msg} })\r\n\r\n    } catch(err) {\r\n        dispatch({type: 'ALERT', payload: {error: err.response.data.msg}})\r\n    }\r\n}"]},"metadata":{},"sourceType":"module"}